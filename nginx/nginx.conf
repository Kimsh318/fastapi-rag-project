server {
    listen 80;
    server_name localhost;

    location / {
        proxy_pass http://172.18.0.5:8000;  # FastAPI 주소
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # REMOVE : 외부망 테스트용으로 Timeout 설정 (300초 = 5분)
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
    }
}



#########################
# TODO : 아래 설정들이 맞는지 한번 검토 필요


# # Nginx 설정 파일
# # Nginx는 고성능 웹 서버이자 리버스 프록시 서버입니다.

# # 프로세스를 실행할 사용자 지정
# user www-data;

# # 워커 프로세스 수 설정 (auto는 CPU 코어 수에 맞춰 자동 설정)
# worker_processes auto;

# # 마스터 프로세스 ID 파일 위치
# pid /run/nginx.pid;

# # 이벤트 모듈 설정
# events {
#     # 워커 프로세스당 동시 연결 수 제한
#     worker_connections 1024;
# }

# # HTTP 서버 설정
# http {
#     # 정적 파일 전송 최적화
#     sendfile on;
#     tcp_nopush on;

#     # 해시 테이블 크기 설정
#     types_hash_max_size 2048;

#     # MIME 타입 설정 파일 포함
#     include /etc/nginx/mime.types;
#     default_type application/octet-stream;

#     # 접근 로그와 에러 로그 위치 설정
#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;

#     # gzip 압축 활성화
#     gzip on;

#     # 서버 블록 설정
#     server {
#         # 80번 포트로 들어오는 모든 요청 처리
#         listen 80;
#         server_name _;

#         # 루트 경로로 들어오는 요청 처리
#         location / {
#             # FastAPI 애플리케이션으로 프록시
#             proxy_pass http://127.0.0.1:8000;
            
#             # 프록시 헤더 설정
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }

#         # Grafana로 들어오는 요청 처리
#         location /grafana/ {
#             # Grafana 서버로 프록시
#             proxy_pass http://localhost:3000/;
            
#             # 프록시 헤더 설정 (Grafana용)
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }
#     }
# }